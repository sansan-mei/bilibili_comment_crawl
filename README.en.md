# &#x1F308;&#x1F308;&#x1F308;Bilibili Comment, Danmaku, and Video Info Crawler&#x1F308;&#x1F308;&#x1F308;

[中文版](README.md)

⭐**IMPORTANT**: This project is for educational purposes only. I am not responsible for any other use!!! ⚠⚠⚠

### This project is for EDUCATIONAL PURPOSES ONLY. Any other use is prohibited!!!

### This project is for EDUCATIONAL PURPOSES ONLY. Any other use is prohibited!!!

### This project is for EDUCATIONAL PURPOSES ONLY. Any other use is prohibited!!!

## Project Introduction

This is a tool for crawling comments, danmaku (bullet screen comments), and video information from Bilibili. It can:

- Get basic video information (title, description, view count, etc.)
- Crawl video comments (including main comments and replies)
- Retrieve video danmaku
- Save data in multiple formats (JSON, TXT, HTML)
- Download videos and extract audio
- Convert video speech to text and generate subtitles
- Provide an interactive command-line interface
- Provide API service endpoints

## Requirements

- Node.js 20+
- Valid Bilibili account cookies

## Installation

1. Clone the repository

```bash
git clone https://github.com/yourusername/bilibili-comment-crawl-js.git
cd bilibili-comment-crawl-js
```

2. Install dependencies

```bash
npm install
# or
yarn install
# or
bun install
```

3. Download Vosk model (optional, for speech-to-text feature)

Download the Chinese speech model from https://alphacephei.com/vosk/models and extract it to the `model` folder in the project root directory.

## Usage

### 1. Find the bvid of the video you want to crawl

The bvid is displayed in the video URL. For example, in the following URL, the bvid is BV1z5RPYHEoD:

```
https://www.bilibili.com/list/watchlater?bvid=BV1z5RPYHEoD&oid=114114831651644
```

### 2. Set up cookies and bvid

First, copy the environment variable example file:

```bash
cp .env.example .env
```

Then edit the `.env` file and set the following parameters:

```
COOKIES=your_browser_cookies_here
B_VID=video_bvid (optional, can be passed when running the command)
EXECUTABLE_PATH=browser_executable_path (optional, for custom browser path, mainly for Windows systems)
IS_FETCH_VIDEO_STREAM=0 # Whether to fetch video stream, 0 for no, 1 for yes
MODEL_PATH=model # Vosk model path for speech-to-text functionality
```

Steps to get cookies:

1. Log in to the Bilibili website
2. Press F12 to open developer tools
3. Switch to the Network tab
4. Refresh the page and select any request
5. Find and copy the complete Cookie value from the request headers

### 3. Run the crawler

```bash
# Using the bvid configured in the .env file
npm run dev
# or
yarn dev

# Or directly specify a bvid
npm run dev BV1z5RPYHEoD
# or
yarn dev BV1z5RPYHEoD
```

### 4. Use the interactive command-line interface

After starting, the program will automatically enter an interactive command-line interface where you can:

1. Enter a BV number to crawl a new video
2. View the list of crawled videos
3. View help information
4. Exit the program

### 5. Use the API service

After starting, the program will automatically start a local API service with default port 39002:

```
http://127.0.0.1:39002/start-crawl/{bvid}
```

Replace {bvid} with the BV number of the video you want to crawl to trigger the crawler via API.

### 6. View the results

After crawling is complete, the program will create a folder named after the video title and oid in the current directory, containing the following files:

- `bilibili_all.txt`: A simple text file containing all information combined
- `bilibili_comments.txt`: Comments data in text format
- `bilibili_danmaku.txt`: Danmaku data in text format
- `bilibili_detail.json`: Video details in JSON format

If the video speech-to-text feature is enabled (IS_FETCH_VIDEO_STREAM=1), the following additional files will be generated:

- `current.mp4`: The downloaded video file
- `current.mp3`: The audio extracted from the video
- `subtitles.txt`: The subtitle file generated by speech recognition

## Advanced Features

### Video Speech-to-Text

Set `IS_FETCH_VIDEO_STREAM=1` and ensure you have downloaded the correct Vosk model to the model directory. The program will automatically download the video, extract the audio, and generate a subtitle file.

### Browser Automation

Set the `EXECUTABLE_PATH` environment variable to point to your Chrome browser executable file path. The program can automatically open the browser to display results after crawling is complete.

## Notes

- The crawler will attempt to retrieve 90% of the total comments (configurable), which may take a long time if there are many comments
- If a request fails, the program will automatically retry up to 3 times
- Please set a reasonable crawling frequency to avoid putting too much pressure on Bilibili's servers
- Please comply with Bilibili's user agreement and relevant laws and regulations
- The video speech-to-text feature requires significant computing resources, so make sure your computer has sufficient configuration
- If you encounter browser-related issues, you can set the `EXECUTABLE_PATH` environment variable to specify a custom browser path

## Disclaimer

This project is for educational and research purposes only. Do not use it for any commercial or illegal purposes. The user assumes all responsibility for any consequences resulting from the use of this tool.
